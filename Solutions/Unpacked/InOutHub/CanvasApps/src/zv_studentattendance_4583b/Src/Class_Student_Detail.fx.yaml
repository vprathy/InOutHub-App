Class_Student_Detail As screen:
    OnVisible: |
        =// Class_Student_Detail.OnVisible
        Refresh(ScanReports);
        
        // Update the "Summary Data as of" time
        Set(ReportTime, Text(Now(), "[$-en-US]hh:mm AM/PM"));
        
        // Force the gallery to pick up refreshed data
        Reset(Gallery1);

    Back_Icon_1 As icon.BackArrow:
        Height: =46
        Icon: =Icon.BackArrow
        OnSelect: |-
            =//Set(ReportClass, Blank());
            //Set(ReportDate, Blank());
            Navigate(Summary_by_Class_Report);
        Width: =46
        X: =49
        Y: =49
        ZIndex: =1

    Gallery1 As gallery.galleryVertical:
        DelayItemLoading: =true
        Height: =618
        Items: |-
            =Sort(
                Filter(
                    ScanReports,
                    ScanReportDate = Value(
                        Text(
                            DatePicker1.SelectedDate,
                            "yyyymmdd"
                        )
                    ) && DayScanClass = Dropdown1.Selected.Value
                ),
                DayScanID
            )
        Layout: =Layout.Vertical
        LoadingSpinner: =LoadingSpinner.Data
        TemplateSize: =46
        Y: =465
        ZIndex: =2

        Label3 As label:
            DisplayMode: =DisplayMode.View
            Height: =25
            OnSelect: =Select(Parent)
            Size: =16
            Text: =ThisItem.DayScanID
            Width: =360
            X: =4
            Y: =8
            ZIndex: =1

        NextArrow1_4 As icon.ChevronRight:
            AccessibleLabel: =Self.Tooltip
            Color: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(255, 255, 255, 1)
            Height: =40
            Icon: =Icon.ChevronRight
            OnSelect: |
                =// 1) Resolve Exceptions row -> Student_Infos record (from cache)
                Set(
                    varSelectedStudent,
                    LookUp(Student_Infos_Cache, IDName = ThisItem.DayScanID)
                );
                
                // 2) If missing in cache, try the table once (optional fallback)
                If(
                    IsBlank(varSelectedStudent),
                    Set(varSelectedStudent, LookUp(Student_Infos, IDName = ThisItem.DayScanID))
                );
                
                // 3) Navigate; do NOT reset the profile
                Navigate(
                    scrStudentProfile,
                    ScreenTransition.Fade,
                    { resetProfile: false, ctxId: ThisItem.DayScanID }
                );
                
                // Track where we came from (optional)
                Set(varFromScreen, "ClassDetail");
            PaddingBottom: =12
            PaddingLeft: =12
            PaddingRight: =12
            PaddingTop: =12
            Tooltip: ="View item details"
            Width: =50
            X: =571
            Y: =2
            ZIndex: =2

        Label4 As label:
            Align: =Align.Center
            Height: =25
            OnSelect: =Select(Parent)
            Size: =16
            Text: =ThisItem.CheckInTag
            Width: =120
            X: =372
            Y: =8
            ZIndex: =3

        Label4_1 As label:
            Align: =Align.Center
            Height: =25
            OnSelect: =Select(Parent)
            Size: =16
            Text: =ThisItem.CheckOutTag
            Width: =54
            X: =516
            Y: =8
            ZIndex: =4

        Rectangle4 As rectangle:
            Height: =4
            OnSelect: =Select(Parent)
            Width: =626
            X: =4
            Y: =41
            ZIndex: =5

    Check_In_Screen_Header_1 As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Semibold
        Height: =46
        Size: =30
        Text: ="Class Report"
        Width: =368
        X: =132
        Y: =49
        ZIndex: =3

    DatePicker1 As datepicker:
        DefaultDate: =ReportDate
        Size: =16
        Width: =194
        X: =179
        Y: =124
        ZIndex: =4

    Dropdown1 As dropdown:
        Default: =ReportClass
        Items: =Distinct(Student_Infos, Class)
        Size: =16
        Width: =157
        X: =448
        Y: =124
        ZIndex: =5

    Label2 As label:
        FontWeight: =FontWeight.Semibold
        Size: =16
        Text: ="Select Date"
        Width: =133
        X: =46
        Y: =124
        ZIndex: =6

    Label2_1 As label:
        FontWeight: =FontWeight.Semibold
        Size: =16
        Text: ="Class"
        Width: =67
        X: =381
        Y: =124
        ZIndex: =7

    Label2_4 As label:
        FontWeight: =FontWeight.Semibold
        Height: =46
        Size: =16
        Text: ="Student ID Name"
        Width: =393
        X: =7
        Y: =412
        ZIndex: =8

    Label2_5 As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Semibold
        Height: =46
        Size: =16
        Text: ="Check In"
        Width: =119
        X: =382
        Y: =412
        ZIndex: =9

    Label2_6 As label:
        Align: =Align.Center
        FontWeight: =FontWeight.Semibold
        Height: =46
        Size: =16
        Text: ="Check Out"
        Width: =120
        X: =493
        Y: =412
        ZIndex: =10

    Rectangle4_1 As rectangle:
        Height: =4
        Width: =626
        X: =7
        Y: =461
        ZIndex: =11

    Rectangle7_1 As rectangle:
        BorderColor: =RGBA(56, 96, 178, 1)
        BorderThickness: =2
        Fill: =RGBA(0, 0, 0, 0)
        Height: =215
        Width: =613
        X: =12
        Y: =196
        ZIndex: =18

    Label8_4 As label:
        Color: =RGBA(255, 0, 0, 1)
        Height: =39
        Italic: =true
        Size: =14
        Text: ="Summary Data as of"
        Width: =185
        X: =22
        Y: =204
        ZIndex: =19

    Label8_5 As label:
        Color: =RGBA(255, 0, 0, 1)
        Height: =39
        Italic: =true
        Size: =14
        Text: =ReportTime
        X: =202
        Y: =204
        ZIndex: =20

    Icon4_2 As icon.Home:
        Height: =46
        Icon: =Icon.Home
        OnSelect: =Navigate(Home_Screen)
        Width: =46
        X: =563
        Y: =49
        ZIndex: =21

    Group2 As group:
        Height: =5
        Width: =5
        X: =60
        Y: =60
        ZIndex: =21

        Label5 As label:
            Align: =Align.Center
            BorderColor: =RGBA(255, 255, 255, 1)
            BorderThickness: =2
            DisplayMode: =DisplayMode.View
            Fill: =RGBA(237, 237, 237, 1)
            FontWeight: =FontWeight.Semibold
            Height: =35
            Size: =16
            Text: |-
                =//CountRows(Gallery1.AllItems)
                CountRows(Filter(Student_Infos_Cache, Class = Dropdown1.Selected.Value))
            Width: =109
            X: =499
            Y: =251
            ZIndex: =12

        Label5_1 As label:
            BorderColor: =RGBA(255, 255, 255, 1)
            BorderThickness: =2
            DisplayMode: =DisplayMode.View
            Fill: =RGBA(237, 237, 237, 1)
            FontWeight: =FontWeight.Semibold
            Height: =35
            Size: =16
            Text: |-
                ="# Class Size"
            Width: =462
            X: =30
            Y: =251
            ZIndex: =13

        Label5_2 As label:
            Align: =Align.Center
            BorderColor: =RGBA(255, 255, 255, 1)
            BorderThickness: =2
            DisplayMode: =DisplayMode.View
            Fill: =RGBA(237, 237, 237, 1)
            FontWeight: =FontWeight.Semibold
            Height: =35
            Size: =16
            Text: |-
                =CountRows(
                    Filter(
                        ScanReports,
                        ScanReportDate = Value(
                            Text(
                                DatePicker1.SelectedDate,
                                "yyyymmdd"
                            )
                        ) && DayScanClass = Dropdown1.Selected.Value && CheckInTag = true
                    )
                )
            Width: =109
            X: =500
            Y: =294
            ZIndex: =14

        Label5_3 As label:
            BorderColor: =RGBA(255, 255, 255, 1)
            BorderThickness: =2
            DisplayMode: =DisplayMode.View
            Fill: =RGBA(237, 237, 237, 1)
            FontWeight: =FontWeight.Semibold
            Height: =35
            Size: =16
            Text: |-
                ="# Checked In"
            Width: =462
            X: =31
            Y: =294
            ZIndex: =15

        Label5_4 As label:
            Align: =Align.Center
            BorderColor: =RGBA(255, 255, 255, 1)
            BorderThickness: =2
            DisplayMode: =DisplayMode.View
            Fill: =RGBA(237, 237, 237, 1)
            FontWeight: =FontWeight.Semibold
            Height: =35
            Size: =16
            Text: |-
                =CountRows(
                    Filter(
                        ScanReports,
                        ScanReportDate = Value(
                            Text(
                                DatePicker1.SelectedDate,
                                "yyyymmdd"
                            )
                        ) && DayScanClass = Dropdown1.Selected.Value && CheckOutTag = true
                    )
                )
            Width: =109
            X: =500
            Y: =338
            ZIndex: =16

        Label5_5 As label:
            BorderColor: =RGBA(255, 255, 255, 1)
            BorderThickness: =2
            DisplayMode: =DisplayMode.View
            Fill: =RGBA(237, 237, 237, 1)
            FontWeight: =FontWeight.Semibold
            Height: =35
            Size: =16
            Text: |-
                ="# Checked Out"
            Width: =462
            X: =31
            Y: =338
            ZIndex: =17

